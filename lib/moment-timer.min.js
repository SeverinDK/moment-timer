!function(t,i){"function"==typeof define&&define.amd?define(["moment"],i):"object"==typeof module&&module.exports?module.exports=i(require("moment")):i(t.moment)}(this,function(t){function e(t,i,e){if(this.timerDuration=t,this.callback=e,this.loop=i.loop,this.started=!1,this.stopped=!1,this.timer,this.startTick,this.endTick,i.start)if(0<i.wait){var r=this;setTimeout(function(){i.executeAfterWait&&e(),r.start()},i.wait)}else this.start()}if(e.prototype.start=function(){if(!this.started){var t=this;return this.stopped?(setTimeout(function(){return t.callback(),t.start()},this.getRemainingDuration()),!(this.stopped=!1)):(this._handleTimerStart(),this.updateStartEndTickFromDuration(t.timerDuration),this.started=!0)}return!1},e.prototype.stop=function(){return!!this.started&&(this.clearTimer(),this.updateStartEndTickFromDuration(this.getRemainingDuration()),this.started=!1,this.stopped=!0)},e.prototype.clearTimer=function(){return!!this.timer&&(this.timer=this.loop?clearInterval(this.timer):clearTimeout(this.timer),!0)},e.prototype.updateStartEndTickFromDuration=function(t){return this.startTick=Date.now(),this.endTick=this.startTick+t,!0},e.prototype.duration=function(){return 0<arguments.length&&(this.timerDuration=t.duration(arguments[0],arguments[1]).asMilliseconds(),this._handleRunningDurationChange(),!0)},e.prototype.getDuration=function(){return this.timerDuration},e.prototype.getRemainingDuration=function(){return this.startTick&&this.endTick?this.stopped?this.endTick-this.startTick:this.endTick-Date.now():0},e.prototype.isStopped=function(){return this.stopped},e.prototype.isStarted=function(){return this.started},e.prototype._handleTimerStart=function(){var t=this;this.loop?this.timer=setInterval(function(){return t.updateStartEndTickFromDuration(t.timerDuration),t.callback()},this.timerDuration):this.timer=setTimeout(function(){return t.started=!1,t.callback()},this.timerDuration)},e.prototype._handleRunningDurationChange=function(){var t=this;this.started&&setTimeout(function(){t.started&&(t.clearTimer(),t._handleTimerStart())},this.getRemainingDuration())},"function"==typeof require)try{t=require("moment")}catch(t){}if(!t&&this.moment&&(t=this.moment),!t)throw"Moment Timer cannot find Moment.js";t.duration.fn.timer=function(t,i){if("function"==typeof t)i=t,t={wait:0,loop:!1,start:!0};else{if("object"!=typeof t||"function"!=typeof i)throw new Error("First argument must be of type function or object.");null==t.start&&(t.start=!0)}return function(){return new e(this.asMilliseconds(),t,i)}.bind(this)()}});
